# 操作系统总结

目前已更新到死锁，待更新：

1. **内存管理**
2. **磁盘管理**

## 进程/线程调度

#### 进程与线程的关系

1.    一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程


2.    资源分配给进程，同一进程的所有线程共享该进程的所有资源


3.    CPU分配给进程，而真正在CPU上运行的是线程





#### 进程与线程的区别

1.    线程作为CPU调度和分配的基本单位，进程作为资源分配的基本单位


2.    进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源


3.    在创建或撤销进程时，系统都要为之分配和回收资源，导致其开销明显大于创建或撤销线程时的开销





#### 进程调度算法

1.    FCFS(先来先服务)


2.    SJF（短进程优先）


3.    Priority（优先级调度）


4.    Round-Robin（轮转法）


5.    Multilevel Queue（多级队列调度）


## 进程/线程通信


#### 临界区

临界区指的是一个访问共用资源（例如：共用设备或是共用存储器）的程序片段，而这些共用资源又无法同时被多个线程访问的特性。当有线程进入临界区段时，其他线程或是进程必须等待。



#### 解决临界区的三个必要条件

1. **mutually exclusion（互斥）**

如果进程Pi在其临界区内执行，那么其他进程都不能在其临界区内执行

2. **Progress（前进）**

如果没有进程在其临界区内执行且有进程需进入临界区，那么只有那么不在剩余区内执行的进程可参加选择，以确定谁能下一个进入临界区，且这种选择不能无限推迟

3. **Bounded Waiting（有限等待）**

从一个进程做出进入临界区的请求，直到该请求允许为止，其他进程允许进入其临界区内的次数有上限



#### 进程/线程同步

1. **临界区（Critical Section）**

通过对多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问。在任意时刻只允许一个线程对共享资源进行访问，如果有多个线程试图访问公共资源，那么在有一个线程进入后，其他试图访问公共资源的线程将被挂起，并一直等到进入临界区的线程离开，临界区在被释放后，其他线程才可以抢占

2. **互斥量（Mutex）**

采用互斥对象机制。 只有拥有互斥对象的线程才有访问公共资源的权限，因为互斥对象只有一个，所以能保证公共资源不会同时被多个线程访问。互斥不仅能实现同一应用程序的公共资源安全共享，还能实现不同应用程序的公共资源安全共享 .互斥量比临界区复杂。因为使用互斥不仅仅能够在同一应用程序不同线程中实现资源的安全共享，而且可以在不同应用程序的线程之间实现对资源的安全共享

3. **信号量（Semaphore）**

允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目 .信号量对象对线程的同步方式与前面几种方法不同，信号允许多个线程同时使用共享资源，这与操作系统中的PV操作相同。它指出了同时访问共享资源的线程最大数目。它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目

4. **事件（Event）**

通过通知操作的方式来保持线程的同步，还可以方便实现对多个线程的优先级比较的操作

 

#### 临界区和互斥量的区别

1.    临界区只能用于对象在同一进程里线程间的互斥访问；互斥量可以用于对象进程间或线程间的互斥访问


2.    临界区是非内核对象，只在用户态进行锁操作，速度快；互斥量是内核对象，在核心态进行锁操作，速度慢


3.    临界区和互斥量在Windows平台都下可用；Linux下只有互斥量可用





#### 进程间通信方式（Inter-Process Communication）

1. **管道(pipe)**

管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。

2. **命名管道(named pipe)**

命名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。

3. **信号量(semophore) **

信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

4. **消息队列( message queue )**

消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

5. **信号(sinal)**

信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

6. **共享内存(shared memory)**

共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信。

7. **套接字(socket)**

套解口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信。

## 死锁

**死锁的四个必要条件**

1. **Mutual exclusion（互斥）**

一个资源每次只能被一个进程使用

2. **Hold and wait（持有并等待）**

一个进程因请求资源而阻塞时，对已获得的资源保持不放

3. **No preemption（非抢占）**

进程已获得的资源，在末使用完之前，不能抢占

4. **Circular wait (循环等待)**

若干进程之间形成一种头尾相接的循环等待资源关系

 

**死锁的解决方法**

1. **死锁的预防(prevention)**

是保证系统不进入死锁状态的一种策略。它的基本思想是要求进程申请资源时遵循某种协议，从而打破产生死锁的四个必要条件中的一个或几个，保证系统不会进入死锁状态。

2. **死锁的避免(avoidance)**

它不限制进程有关申请资源的命令，而是对进程所发出的每一个申请资源命令加以动态地检查，并根据检查结果决定是否进行资源分配。就是说，在资源分配过程中若预测有发生死锁的可能性，则加以避免。这种方法的关键是确定资源分配的安全性。

3. **死锁的检测与恢复(detect and recover)**

系统为进程分配资源时，不采取任何限制性措施，但是提供了检测和解脱死锁的手段：能发现死锁并从死锁状态中恢复出来。

4. **鸵鸟策略(ignore)**

当系统发生死锁时不会对用户造成多大影响，或系统很少发生死锁的场合采用允许死锁发生的鸵鸟策略，这样一来可能开销比不允许发生死锁及检测和解除死锁的小。
